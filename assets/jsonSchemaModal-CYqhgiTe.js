import{d as w,r as M,k as R,c as m,o as u,l as V,b as t,a as N,e as j,g as D,v as J,f as A,m as P,p as z,F as $,j as B,q as T,_ as O,i as K,w as U,t as F,h as I,n as L}from"./index-rONAuxrM.js";import"./html2pdf-GX85U5Jj.js";import"./marked-B-UsxTFJ.js";import"./dompurify-CQJ0hv7W.js";import"./prismjs-BZbXmqYC.js";const E={class:"node-controls"},G={class:"checkbox-label"},x=w({__name:"SchemaNode",props:{node:{},depth:{}},emits:["add-child","remove","type-change"],setup(v,{emit:h}){const n=v,a=h,e=M(n.depth||0),k=()=>{a("add-child",n.node)},C=()=>{a("remove",n.node.key)},g=()=>{n.node.type==="object"&&!n.node.properties&&(n.node.properties=[]),a("type-change",n.node)},S=r=>{a("add-child",r)},q=r=>{a("remove",r)},y=r=>{a("type-change",r)};return(r,d)=>{const f=R("SchemaNode",!0);return u(),m("div",{class:"schema-node",style:V({marginLeft:`${e.value*20}px`})},[t("div",E,[j(t("input",{"onUpdate:modelValue":d[0]||(d[0]=l=>r.node.name=l),placeholder:"属性名",class:"property-input"},null,512),[[D,r.node.name]]),j(t("select",{"onUpdate:modelValue":d[1]||(d[1]=l=>r.node.type=l),class:"property-select",onChange:g},d[3]||(d[3]=[A('<option value="string" data-v-2bfd98bb>string</option><option value="number" data-v-2bfd98bb>number</option><option value="boolean" data-v-2bfd98bb>boolean</option><option value="object" data-v-2bfd98bb>object</option><option value="array" data-v-2bfd98bb>array</option>',5)]),544),[[J,r.node.type]]),t("label",G,[d[4]||(d[4]=P(" 必填 ",-1)),j(t("input",{type:"checkbox","onUpdate:modelValue":d[2]||(d[2]=l=>r.node.required=l),class:"property-checkbox"},null,512),[[z,r.node.required]])]),r.node.type==="object"?(u(),m("button",{key:0,class:"add-child-btn",onClick:k}," + 子属性 ")):N("",!0),t("button",{class:"remove-btn",onClick:C}," × ")]),r.node.type==="object"&&r.node.properties?(u(!0),m($,{key:0},B(r.node.properties,l=>(u(),T(f,{key:l.key,node:l,depth:e.value+1,onAddChild:S,onRemove:q,onTypeChange:y},null,8,["node","depth"]))),128)):N("",!0)],4)}}}),H=O(x,[["__scopeId","data-v-2bfd98bb"]]),_=()=>{const v=Date.now().toString(36),h=Math.random().toString(36).slice(-6),n="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let e=0;e<8;e++)a+=n.charAt(Math.floor(Math.random()*n.length));return`${v}-${h}-${a}`},Q={class:"modal-body"},W={class:"schema-controls"},X=["disabled"],Y={key:0,class:"schema-tree"},Z={key:1,class:"empty-state"},ee={class:"schema-preview"},oe={class:"preview-code"},te={class:"modal-footer"},re=["disabled"],se=w({__name:"jsonSchemaModal",props:{visible:{type:Boolean},isDarkMode:{type:Boolean},defaultSchema:{}},emits:["close","confirm","error"],setup(v,{emit:h}){const n=v,a=h,e=M({type:"object",properties:void 0,required:[]}),k=()=>{e.value.properties||(e.value.properties=[],e.value.required=[])},C=()=>{if(!e.value.properties)return;const o=_(),s={key:o,name:`prop${e.value.properties.length+1}`,type:"string",required:!0};e.value.properties.push(s),y(o,!0)},g=o=>{o.properties||(o.properties=[]);const i={key:_(),name:`subProp${o.properties.length+1}`,type:"string",required:!0};o.properties.push(i)},S=o=>{if(!e.value.properties)return;const s=i=>i.filter(p=>p.key===o?!1:(p.properties&&(p.properties=s(p.properties)),!0));e.value.properties=s(e.value.properties),y(o,!1)},q=o=>{o.type==="object"&&!o.properties&&(o.properties=[])},y=(o,s)=>{e.value.required&&(s&&!e.value.required.includes(o)?e.value.required.push(o):s||(e.value.required=e.value.required.filter(i=>i!==o)))},r=K(()=>{if(!e.value.properties)return"{}";const o=i=>i.reduce((p,c)=>(p[c.name]={type:c.type},c.type==="object"&&c.properties&&(p[c.name].properties=o(c.properties),c.properties.some(b=>b.required)&&(p[c.name].required=c.properties.filter(b=>b.required).map(b=>b.name))),p),{}),s={type:"object",properties:o(e.value.properties),required:e.value.properties.filter(i=>i.required).map(i=>i.name)};return JSON.stringify(s,null,2)}),d=()=>{if(!e.value.properties){a("error","请先配置JSON Schema");return}const o=`
\`\`\`js
${r.value}
\`\`\``;a("confirm",o)},f=()=>{a("close")},l=()=>{a("close")};return U(()=>n.visible,o=>{o&&n.defaultSchema?e.value=JSON.parse(JSON.stringify(n.defaultSchema)):o||(e.value={type:"object",properties:void 0,required:[]})}),(o,s)=>o.visible?(u(),m("div",{key:0,class:"json-modal-mask",onClick:l},[t("div",{class:L(["json-modal",{"app-dark":o.isDarkMode}]),onClick:s[0]||(s[0]=I(()=>{},["stop"]))},[t("div",{class:"modal-header"},[s[1]||(s[1]=t("h3",null,"JSON Schema 配置",-1)),t("button",{class:"modal-close",onClick:f},"×")]),t("div",Q,[t("div",W,[t("button",{class:"add-btn",onClick:k},"初始化根对象"),t("button",{class:"add-btn",onClick:C,disabled:!e.value.properties},"添加属性",8,X)]),e.value.properties?(u(),m("div",Y,[(u(!0),m($,null,B(e.value.properties,i=>(u(),T(H,{key:i.key,node:i,depth:0,onAddChild:g,onRemove:S,onTypeChange:q},null,8,["node"]))),128))])):(u(),m("div",Z,' 请点击"初始化根对象"开始配置 ')),t("div",ee,[s[2]||(s[2]=t("h4",null,"预览:",-1)),t("pre",oe,F(r.value),1)])]),t("div",te,[t("button",{class:"cancel-btn",onClick:f},"取消"),t("button",{class:"confirm-btn",onClick:d,disabled:!e.value.properties}," 确认插入 ",8,re)])],2)])):N("",!0)}}),pe=O(se,[["__scopeId","data-v-1dd03955"]]);export{pe as default};
