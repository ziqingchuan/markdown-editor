import{d as B,r as O,i as D,w as E,c as n,a as v,o as l,b as t,F as y,j as f,t as J,h as P,n as R,e as d,g as _,v as k,f as T,k as C,l as F,_ as z}from"./index-apNfurVs.js";import"./html2pdf-GX85U5Jj.js";import"./marked-B-UsxTFJ.js";import"./dompurify-CQJ0hv7W.js";import"./prismjs-BZbXmqYC.js";const I={class:"modal-body"},L={class:"schema-controls"},A=["disabled"],G={key:0,class:"schema-tree"},H={class:"schema-root"},K={class:"properties-list"},Q={class:"property-controls"},W=["onUpdate:modelValue"],X=["onUpdate:modelValue","onChange"],Y={class:"checkbox-label"},Z=["onUpdate:modelValue","onChange"],ee=["onClick"],te={key:0,class:"nested-object"},oe=["onClick"],se=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ae=["onClick"],ie={key:1,class:"empty-state"},ne={class:"schema-preview"},le={class:"preview-code"},de={class:"modal-footer"},pe=["disabled"],ce=B({__name:"jsonSchemaModal",props:{visible:{type:Boolean},isDarkMode:{type:Boolean},defaultSchema:{}},emits:["close","confirm","error"],setup(q,{emit:g}){const u=q,o=O({type:"object",properties:void 0,required:[]}),j=()=>{o.value.properties||(o.value.properties={},o.value.required=[])},S=()=>{var e,r;if(!o.value.properties)return;const s=`prop${Object.keys(o.value.properties).length+1}`;o.value.properties[s]={name:s,type:"string",required:!0},(e=o.value.required)!=null&&e.includes(s)||(r=o.value.required)==null||r.push(s)},V=(s,e)=>{e.type==="object"&&!e.properties&&(e.properties=[])},U=(s,e)=>{o.value.required&&(e.required?o.value.required.includes(s)||o.value.required.push(s):o.value.required=o.value.required.filter(r=>r!==s))},x=s=>{var e;o.value.properties&&(delete o.value.properties[s],o.value.required=(e=o.value.required)==null?void 0:e.filter(r=>r!==s))},M=s=>{if(!o.value.properties)return;const e=o.value.properties[s];e.properties||(e.properties=[]),e.properties.push({name:`subProp${e.properties.length+1}`,type:"string",required:!0})},N=(s,e)=>{if(!o.value.properties)return;const r=o.value.properties[s];r.properties&&r.properties.splice(e,1)},m=D(()=>{if(!o.value.properties)return"{}";const s={type:"object",properties:{},required:o.value.required};return Object.values(o.value.properties).forEach(e=>{if(s.properties[e.name]={type:e.type},e.type==="object"&&e.properties){s.properties[e.name].properties={},e.properties.forEach(i=>{s.properties[e.name].properties[i.name]={type:i.type}});const r=e.properties.filter(i=>i.required).map(i=>i.name);r.length>0&&(s.properties[e.name].required=r)}}),JSON.stringify(s,null,2)}),p=g,$=()=>{if(!o.value.properties){p("error","请先配置JSON Schema");return}const e=`
\`\`\`json
${m.value}
\`\`\``;p("confirm",e)},h=()=>{p("close")},w=()=>{p("close")};return E(()=>u.visible,s=>{s&&u.defaultSchema?o.value={...u.defaultSchema}:s||(o.value={type:"object",properties:void 0,required:[]})}),(s,e)=>s.visible?(l(),n("div",{key:0,class:"json-modal-mask",onClick:w},[t("div",{class:R(["json-modal",{"app-dark":s.isDarkMode}]),onClick:e[0]||(e[0]=P(()=>{},["stop"]))},[t("div",{class:"modal-header"},[e[1]||(e[1]=t("h3",null,"JSON Schema 配置",-1)),t("button",{class:"modal-close",onClick:h},"×")]),t("div",I,[t("div",L,[t("button",{class:"add-btn",onClick:j},"初始化根对象"),t("button",{class:"add-btn",onClick:S,disabled:!o.value.properties},"添加属性",8,A)]),o.value.properties?(l(),n("div",G,[t("div",H,[e[5]||(e[5]=t("div",{class:"property-header"},[t("span",{class:"property-name"},"根对象"),t("span",{class:"property-type"},"object")],-1)),t("div",K,[(l(!0),n(y,null,f(o.value.properties,(r,i)=>(l(),n("div",{key:i,class:"property-item"},[t("div",Q,[d(t("input",{type:"text","onUpdate:modelValue":a=>r.name=a,class:"property-input",placeholder:"属性名"},null,8,W),[[_,r.name]]),d(t("select",{"onUpdate:modelValue":a=>r.type=a,class:"property-select",onChange:a=>V(i,r)},e[2]||(e[2]=[T('<option value="string" data-v-803aa230>string</option><option value="number" data-v-803aa230>number</option><option value="boolean" data-v-803aa230>boolean</option><option value="object" data-v-803aa230>object</option><option value="array" data-v-803aa230>array</option>',5)]),40,X),[[k,r.type]]),t("label",Y,[e[3]||(e[3]=C(" 必选字段 ",-1)),d(t("input",{type:"checkbox","onUpdate:modelValue":a=>r.required=a,class:"property-checkbox",onChange:a=>U(i,r)},null,40,Z),[[F,r.required]])]),t("button",{class:"remove-btn",onClick:a=>x(i)}," 删除 ",8,ee)]),r.type==="object"?(l(),n("div",te,[t("button",{class:"nested-add-btn",onClick:a=>M(i)}," + 添加子属性 ",8,oe),r.properties&&r.properties.length>0?(l(!0),n(y,{key:0},f(r.properties,(a,b)=>(l(),n("div",{key:b,class:"nested-property-item"},[d(t("input",{type:"text","onUpdate:modelValue":c=>a.name=c,class:"nested-property-input",placeholder:"子属性名"},null,8,se),[[_,a.name]]),d(t("select",{"onUpdate:modelValue":c=>a.type=c,class:"nested-property-select"},e[4]||(e[4]=[t("option",{value:"string"},"string",-1),t("option",{value:"number"},"number",-1),t("option",{value:"boolean"},"boolean",-1),t("option",{value:"array"},"array",-1),C(" < ",-1)]),8,re),[[k,a.type]]),t("button",{class:"nested-remove-btn",onClick:c=>N(i,b)}," × ",8,ae)]))),128)):v("",!0)])):v("",!0)]))),128))])])])):(l(),n("div",ie,' 请点击"初始化根对象"开始配置 ')),t("div",ne,[e[6]||(e[6]=t("h4",null,"预览:",-1)),t("pre",le,J(m.value),1)])]),t("div",de,[t("button",{class:"cancel-btn",onClick:h},"取消"),t("button",{class:"confirm-btn",onClick:$,disabled:!o.value.properties}," 确认插入 ",8,pe)])],2)])):v("",!0)}}),ye=z(ce,[["__scopeId","data-v-803aa230"]]);export{ye as default};
