import{d as U,r as B,i as D,w as O,c as n,a as y,o as l,b as o,F as k,j as _,t as E,h as J,n as T,e as c,g as q,v as C,f as z,k as F,l as A,_ as G}from"./index-1cdIJMyf.js";import"./html2pdf-GX85U5Jj.js";import"./marked-B-UsxTFJ.js";import"./dompurify-CQJ0hv7W.js";import"./prismjs-BZbXmqYC.js";const g=()=>{const v=Date.now().toString(36),h=Math.random().toString(36).slice(-6),d="abcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let u=0;u<8;u++)s+=d.charAt(Math.floor(Math.random()*d.length));return`${v}-${h}-${s}`},I={class:"modal-body"},K={class:"schema-controls"},L=["disabled"],H={key:0,class:"schema-tree"},Q={class:"schema-root"},W={class:"properties-list"},X={class:"property-controls"},Y=["onUpdate:modelValue"],Z=["onUpdate:modelValue","onChange"],P={class:"checkbox-label"},ee=["onUpdate:modelValue","onChange"],te=["onClick"],se={key:0,class:"nested-object"},oe=["onClick"],re=["onUpdate:modelValue"],ie=["onUpdate:modelValue"],ae=["onClick"],ne={key:1,class:"empty-state"},le={class:"schema-preview"},de={class:"preview-code"},ce={class:"modal-footer"},ue=["disabled"],pe=U({__name:"jsonSchemaModal",props:{visible:{type:Boolean},isDarkMode:{type:Boolean},defaultSchema:{}},emits:["close","confirm","error"],setup(v,{emit:h}){const d=v,s=B({type:"object",properties:void 0,required:[]}),u=()=>{s.value.properties||(s.value.properties=[],s.value.required=[])},S=()=>{var t,i;if(!s.value.properties)return;const e=g(),r={key:e,name:`prop${s.value.properties.length+1}`,type:"string",required:!0};s.value.properties.push(r),(t=s.value.required)!=null&&t.includes(e)||(i=s.value.required)==null||i.push(e)},j=e=>{e.type==="object"&&!e.properties&&(e.properties=[])},V=e=>{s.value.required&&(e.required&&!s.value.required.includes(e.key)?s.value.required.push(e.key):!e.required&&s.value.required.includes(e.key)&&(s.value.required=s.value.required.filter(r=>r!==e.key)))},M=e=>{e.properties||(e.properties=[]);const r=g();e.properties.push({key:r,name:`subProp${e.properties.length+1}`,type:"string",required:!0}),e.nestedRequired||(e.nestedRequired=[]),e.nestedRequired.push(r)},R=(e,r)=>{e.properties&&(e.properties=e.properties.filter(t=>t.key!==r),e.nestedRequired&&(e.nestedRequired=e.nestedRequired.filter(t=>t!==r)))},$=e=>{var r;s.value.properties&&(s.value.properties=s.value.properties.filter(t=>t.key!==e),s.value.required=(r=s.value.required)==null?void 0:r.filter(t=>t!==e))},b=D(()=>{var r;if(!s.value.properties)return"{}";const e={type:"object",properties:{},required:(r=s.value.required)==null?void 0:r.map(t=>{var a;const i=(a=s.value.properties)==null?void 0:a.find(m=>m.key===t);return(i==null?void 0:i.name)||t})};return s.value.properties.forEach(t=>{e.properties[t.name]={type:t.type},t.type==="object"&&t.properties&&(e.properties[t.name].properties={},t.properties.forEach(i=>{e.properties[t.name].properties[i.name]={type:i.type}}),t.nestedRequired&&t.nestedRequired.length>0&&(e.properties[t.name].required=t.nestedRequired.map(i=>{var m;const a=(m=t.properties)==null?void 0:m.find(N=>N.key===i);return(a==null?void 0:a.name)||i})))}),JSON.stringify(e,null,2)}),p=h,w=()=>{if(!s.value.properties){p("error","请先配置JSON Schema");return}const r=`
\`\`\`json
${b.value}
\`\`\``;p("confirm",r)},f=()=>{p("close")},x=()=>{p("close")};return O(()=>d.visible,e=>{e&&d.defaultSchema?s.value={...d.defaultSchema}:e||(s.value={type:"object",properties:void 0,required:[]})}),(e,r)=>e.visible?(l(),n("div",{key:0,class:"json-modal-mask",onClick:x},[o("div",{class:T(["json-modal",{"app-dark":e.isDarkMode}]),onClick:r[0]||(r[0]=J(()=>{},["stop"]))},[o("div",{class:"modal-header"},[r[1]||(r[1]=o("h3",null,"JSON Schema 配置",-1)),o("button",{class:"modal-close",onClick:f},"×")]),o("div",I,[o("div",K,[o("button",{class:"add-btn",onClick:u},"初始化根对象"),o("button",{class:"add-btn",onClick:S,disabled:!s.value.properties},"添加属性",8,L)]),s.value.properties?(l(),n("div",H,[o("div",Q,[r[5]||(r[5]=o("div",{class:"property-header"},[o("span",{class:"property-name"},"根对象"),o("span",{class:"property-type"},"object")],-1)),o("div",W,[(l(!0),n(k,null,_(s.value.properties,t=>(l(),n("div",{key:t.key,class:"property-item"},[o("div",X,[c(o("input",{type:"text","onUpdate:modelValue":i=>t.name=i,class:"property-input",placeholder:"属性名"},null,8,Y),[[q,t.name]]),c(o("select",{"onUpdate:modelValue":i=>t.type=i,class:"property-select",onChange:i=>j(t)},r[2]||(r[2]=[z('<option value="string" data-v-6cd94111>string</option><option value="number" data-v-6cd94111>number</option><option value="boolean" data-v-6cd94111>boolean</option><option value="object" data-v-6cd94111>object</option><option value="array" data-v-6cd94111>array</option>',5)]),40,Z),[[C,t.type]]),o("label",P,[r[3]||(r[3]=F(" 必选字段 ",-1)),c(o("input",{type:"checkbox","onUpdate:modelValue":i=>t.required=i,class:"property-checkbox",onChange:i=>V(t)},null,40,ee),[[A,t.required]])]),o("button",{class:"remove-btn",onClick:i=>$(t.key)}," 删除 ",8,te)]),t.type==="object"?(l(),n("div",se,[o("button",{class:"nested-add-btn",onClick:i=>M(t)}," + 添加子属性 ",8,oe),t.properties&&t.properties.length>0?(l(!0),n(k,{key:0},_(t.properties,i=>(l(),n("div",{key:i.key,class:"nested-property-item"},[c(o("input",{type:"text","onUpdate:modelValue":a=>i.name=a,class:"nested-property-input",placeholder:"子属性名"},null,8,re),[[q,i.name]]),c(o("select",{"onUpdate:modelValue":a=>i.type=a,class:"nested-property-select"},r[4]||(r[4]=[o("option",{value:"string"},"string",-1),o("option",{value:"number"},"number",-1),o("option",{value:"boolean"},"boolean",-1),o("option",{value:"array"},"array",-1)]),8,ie),[[C,i.type]]),o("button",{class:"nested-remove-btn",onClick:a=>R(t,i.key)}," × ",8,ae)]))),128)):y("",!0)])):y("",!0)]))),128))])])])):(l(),n("div",ne,' 请点击"初始化根对象"开始配置 ')),o("div",le,[r[6]||(r[6]=o("h4",null,"预览:",-1)),o("pre",de,E(b.value),1)])]),o("div",ce,[o("button",{class:"cancel-btn",onClick:f},"取消"),o("button",{class:"confirm-btn",onClick:w,disabled:!s.value.properties}," 确认插入 ",8,ue)])],2)])):y("",!0)}}),fe=G(pe,[["__scopeId","data-v-6cd94111"]]);export{fe as default};
